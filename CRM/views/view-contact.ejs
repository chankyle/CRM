<!doctype html>
<html lang="en">
 <head>
 <!-- Required meta tags -->
 <meta charset="utf-8">
 <meta name="viewport" content="width=device-width, initial-scale=1">

 <!-- CoreUI CSS -->
 <link rel="stylesheet" href="https://unpkg.com/@coreui/coreui@3.0.0-rc.0/dist/css/coreui.min.css" crossorigin="anonymous">
 <link rel="stylesheet" href="https://unpkg.com/@coreui/icons@1.0.0/css/all.min.css">

 <title>CRM - View Contact</title>

 <script>

 window.onload = function() {
   var isEditing = false;

   document.getElementById('editContactClientID').onclick = function(){
     if (isEditing == false) {
       isEditing = true;
     document.getElementById('contactClientID').disabled = false;
     document.getElementById('updateContactClientID').type = 'button';
     document.getElementById('editContactClientID').type = 'hidden';
   } else {window.alert("Only 1 field can be edited at a time");};
   }
   document.getElementById('updateContactClientID').onclick = function(){
     isEditing = false;
     document.getElementById('contactClientID').disabled = true;
     document.getElementById('updateContactClientID').type = 'hidden';
     document.getElementById('editContactClientID').type = 'button';
   }

   document.getElementById('editContactPosition').onclick = function(){
     if (isEditing == false) {
       isEditing = true;
     document.getElementById('contactPosition').readOnly = false;
     document.getElementById('updateContactPosition').type = 'button';
     document.getElementById('editContactPosition').type = 'hidden';
   } else {window.alert("Only 1 field can be edited at a time");};
   }
   document.getElementById('updateContactPosition').onclick = function(){
     isEditing = false;
     document.getElementById('contactPosition').readOnly = true;
     document.getElementById('updateContactPosition').type = 'hidden';
     document.getElementById('editContactPosition').type = 'button';
   }

   document.getElementById('editContactPhone').onclick = function(){
     if (isEditing == false) {
       isEditing = true;
     document.getElementById('contactPhone').readOnly = false;
     document.getElementById('updateContactPhone').type = 'button';
     document.getElementById('editContactPhone').type = 'hidden';
   } else {window.alert("Only 1 field can be edited at a time");};
   }
   document.getElementById('updateContactPhone').onclick = function(){
     isEditing = false;
     document.getElementById('contactPhone').readOnly = true;
     document.getElementById('updateContactPhone').type = 'hidden';
     document.getElementById('editContactPhone').type = 'button';
   }

   document.getElementById('editContactMobile').onclick = function(){
     if (isEditing == false) {
       isEditing = true;
     document.getElementById('contactMobile').readOnly = false;
     document.getElementById('updateContactMobile').type = 'button';
     document.getElementById('editContactMobile').type = 'hidden';
   } else {window.alert("Only 1 field can be edited at a time");};
   }
   document.getElementById('updateContactMobile').onclick = function(){
     isEditing = false;
     document.getElementById('contactMobile').readOnly = true;
     document.getElementById('updateContactMobile').type = 'hidden';
     document.getElementById('editContactMobile').type = 'button';
   }

   document.getElementById('editContactEmail').onclick = function(){
     if (isEditing == false) {
       isEditing = true;
     document.getElementById('contactEmail').readOnly = false;
     document.getElementById('updateContactEmail').type = 'button';
     document.getElementById('editContactEmail').type = 'hidden';
   } else {window.alert("Only 1 field can be edited at a time");};
   }
   document.getElementById('updateContactEmail').onclick = function(){
     isEditing = false;
     document.getElementById('contactEmail').readOnly = true;
     document.getElementById('updateContactEmail').type = 'hidden';
     document.getElementById('editContactEmail').type = 'button';
   }

   document.getElementById('editContactNotes').onclick = function(){
     if (isEditing == false) {
       isEditing = true;
     document.getElementById('contactNotes').readOnly = false;
     document.getElementById('updateContactNotes').type = 'button';
     document.getElementById('editContactNotes').type = 'hidden';
   } else {window.alert("Only 1 field can be edited at a time");};
   }
   document.getElementById('updateContactNotes').onclick = function(){
     isEditing = false;
     document.getElementById('contactNotes').readOnly = true;
     document.getElementById('updateContactNotes').type = 'hidden';
     document.getElementById('editContactNotes').type = 'button';
   }

   document.getElementById('editContactStatus').onclick = function(){
     if (isEditing == false) {
       isEditing = true;
     document.getElementById('contactStatus').disabled = false;
     document.getElementById('updateContactStatus').type = 'button';
     document.getElementById('editContactStatus').type = 'hidden';
   } else {window.alert("Only 1 field can be edited at a time");};
   }
   document.getElementById('updateContactStatus').onclick = function(){
     isEditing = false;
     document.getElementById('contactStatus').disabled = true;
     document.getElementById('updateContactStatus').type = 'hidden';
     document.getElementById('editContactStatus').type = 'button';
   }
 }
 </script>

 </head>
 <body class="c-app">

   <div class="c-sidebar c-sidebar-light c-sidebar-fixed c-sidebar-lg-show" id="sidebar">
     <% include partials/sidebar %>
   </div>

  <div class="c-wrapper">
    <header class="c-header c-header-dark bg-primary c-header-fixed">
      <!-- Header content here -->
      <% include partials/header %>
    </header>
    <div class="c-body">
      <main class="c-main">
        <!-- Main content here -->
        <main class="main mt-2 mx-3">
          <form id="formEditContact" name="viewContact" method="post" action="/viewContact" onsubmit="enableFields()">
          <input type="name" class="form-control" id="contactID" name="contactID" value="<%= contactID %>" hidden>
          <div class="card w-auto">
            <h3 class="card-header">View/Edit Contact</h3>
            <div class="card-body">
          <h4> Contact Information</h4>
          <table class="table table-bordered">
            <thead class="thead-dark">
              <tr>
                <th style="width: 15%" scope="col" class="align-middle">Name:</th>
                <th class="align-middle"> <%= result.contact[0].contactFirstName %> <%= result.contact[0].contactLastName %> </th>
                <th style="width: 5%" scope="col"></th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row" class="align-middle">Client:</th>
                <td class="align-middle">
                  <select class="form-control" id="contactClientID" name="contactClientID" disabled required>
                    <%
                        var list = '';
                        for (i = 0; i < result.clients.length; i++) {
                          if (result.clients[i].clientName == result.contact[0].contactClientID){
                            list += '<option selected>' + result.clients[i].clientName + '</option>';
                          } else {
                            list += '<option>' + result.clients[i].clientName + '</option>';
                          }
                        }
                    %>
                      <%- list %>
                  </select>
              </td>
              <td class="align-middle" style="text-align:center">
                <input type="button" id="editContactClientID" value="edit"></input>
                <input type="hidden" id="updateContactClientID" value="Save"></input>
              </td>
              </tr>
              <tr>
                <th scope="row" class="align-middle">Position:</th>
                <td class="align-middle">
                  <input type="text" class="form-control" id="contactPosition" name="contactPosition" value = "<%= result.contact[0].contactPosition %>" required readonly>
                </td>
                <td class="align-middle" style="text-align:center">
                  <input type="button" id="editContactPosition" value="edit"></input>
                  <input type="hidden" id="updateContactPosition" value="Save"></input>
                </td>
              </tr>
              <tr>
                <th scope="row" class="align-middle">Contact Phone Number:</th>
                <td class="align-middle">
                  <input type="text" class="form-control" id="contactPhone" name="contactPhone" value = "<%= result.contact[0].contactPhone %>" readonly>
                </td>
                <td class="align-middle" style="text-align:center">
                  <input type="button" id="editContactPhone" value="edit"></input>
                  <input type="hidden" id="updateContactPhone" value="Save"></input>
                </td>
              </tr>
              <tr>
                <th scope="row" class="align-middle">Contact Mobile Number:</th>
                <td class="align-middle">
                  <input type="text" class="form-control" id="contactMobile" name="contactMobile" value = "<%= result.contact[0].contactMobile %>" readonly>
                </td>
                <td class="align-middle" style="text-align:center">
                  <input type="button" id="editContactMobile" value="edit"></input>
                  <input type="hidden" id="updateContactMobile" value="Save"></input>
                </td>
              </tr>
              <tr>
                <th scope="row" class="align-middle">Email Address:</th>
                <td class="align-middle">
                  <input type="email" class="form-control" id="contactEmail" name="contactEmail" value = "<%= result.contact[0].contactEmail %>" readonly>
                </td>
                <td class="align-middle" style="text-align:center">
                  <input type="button" id="editContactEmail" value="edit"></input>
                  <input type="hidden" id="updateContactEmail" value="Save"></input>
                </td>
              </tr>
              <tr>
                <th scope="row" class="align-middle">Notes:</th>
                <td class="align-middle">
                  <input type="text" class="form-control" id="contactNotes" name="contactNotes" value = "<%= result.contact[0].contactNotes %>" readonly>
                </td>
                <td class="align-middle" style="text-align:center">
                  <input type="button" id="editContactNotes" value="edit"></input>
                  <input type="hidden" id="updateContactNotes" value="Save"></input>
                </td>
              </tr>
              <tr>
                <th scope="row" class="align-middle">Status:</th>
                <td class="align-middle">
                  <select class="form-control" id="contactStatus" name="contactStatus" disabled required>
                    <%
                    var statusList = '';
                      if(result.contact[0].contactStatus == "Enabled"){
                        statusList += '<option selected>Enabled</option>';
                        statusList += '<option>Disabled</option>';
                    } else {
                        statusList += '<option>Enabled</option>';
                        statusList += '<option selected>Disabled</option>';
                    }
                    %>
                    <%- statusList %>
                  </select>
                </td>
                <td class="align-middle" style="text-align:center">
                <input type="button" id="editContactStatus" value="edit"></input>
                <input type="hidden" id="updateContactStatus" value="Save"></input>
              </td>
              </tr>
            </tbody>
          </table>
          <!--All drop down fields need to be set at enabled before they will be sent as part of the payload to mongo -->
          <script>
            function enableFields() {
              document.getElementById('contactClientID').disabled = false;
              document.getElementById('contactStatus').disabled = false;
           }
          </script>
          <button type="submit" class="btn btn-primary btn-lg">Submit</button>
          </form>

    <!-- Contact History Snapshot - thinking maybe last 5 entries -->

                <h4> Communication History</h4>
                <div class="table-responsive">
                  <table class="table table-bordered">
                    <thead class="thead-dark">
                      <tr>
                        <th scope="col"></th>
                        <th scope="col">DATE</th>
                        <th scope="col">AGENT</th>
                        <th scope="col">CONTACT 1</th>
                        <th scope="col">CONTACT 2</th>
                        <th scope="col">VISIT TYPE</th>
                        <th scope="col">REMARKS</th>
                      </tr>
                    </thead>
                    <tr>
                      <%
                        var eventsList ='';
                        var k = 1;
                        for (i = 0; i < result.events.length; i++) {
                          k = i + 1;
                          eventsList += '<th scope="row">' + k + '</th>';
                          var date = result.events[i].eventTimeIn._i;
                          var str = date.toString();
                          str = str.substr(0,10);
                          eventsList += '<td>' + str + '</td>';
                          eventsList += '<td>' + result.events[i].agentAbbrev + '</td>';
                          eventsList += '<td>' + result.events[i].contact1 + '</td>';
                          eventsList += '<td>' + result.events[i].contact2 + '</td>';
                          eventsList += '<td>' + result.events[i].eventType + '</td>';
                          eventsList += '<td>' + result.events[i].eventRemarks + '</td>';
                          eventsList += '</tr>';
                      }
                      %>
                      <%- eventsList %>
                    <tbody>
                    </tbody>
                  </table>
                </div>

    <!-- BACK BUTTON -->
          <div class="form-row">
            <div class="form-group col">
              <button type="button" class="btn btn-primary" onclick="goBack()">Back</button>
            </div>
            <script>
              function goBack() {
                window.history.back();
              }
            </script>
          </div>
        </div>
      </div>

        </main>
      </main>
    </div>
    <footer class="c-footer">
      <!-- Footer content here -->
      <h1>Footer Content</h1>
    </footer>
  </div>

  <!-- Optional JavaScript -->
 <!-- Popper.js first, then CoreUI JS -->
 <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.15.0/umd/popper.min.js" integrity="sha384-L2pyEeut/H3mtgCBaUNw7KWzp5n9&#43;4pDQiExs933/5QfaTh8YStYFFkOzSoXjlTb" crossorigin="anonymous"></script>
 <script src="https://unpkg.com/@coreui/coreui@3.0.0-rc.0/dist/js/coreui.min.js"></script>
 </body>
</html>
