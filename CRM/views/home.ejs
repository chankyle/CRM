<!Doctype html>
<html lang="en">
 <head>
 <!-- Required meta tags -->
 <meta charset="utf-8">
 <meta name="viewport" content="width=device-width, initial-scale=1">
 <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>

 <!-- Bootstrap Table CSS -->
 <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.18.0/dist/bootstrap-table.min.css">
 <!-- CoreUI CSS -->
 <link rel="stylesheet" href="https://unpkg.com/@coreui/coreui@3.0.0-rc.0/dist/css/coreui.min.css" crossorigin="anonymous">
 <link rel="stylesheet" href="https://unpkg.com/@coreui/icons@1.0.0/css/all.min.css">

 <title>RECORD - Home</title>
 </head>
 <body class="c-app">

   <div class="c-sidebar c-sidebar-light c-sidebar-fixed c-sidebar-lg-show" id="sidebar">
     <% include partials/sidebar %>
   </div>

  <div class="c-wrapper">
    <header class="c-header c-header-dark bg-primary c-header-fixed">
      <!-- Header content here -->
      <% include partials/header %>
    </header>
    <div class="c-body">

      <main class="c-main mx-4 my-0">
        <!-- Main content here -->
        <h1> Welcome to your Dashboard, <%-  user.username.charAt(0).toUpperCase() + user.username.slice(1);%>! </h1>
        <hr>

        <div class="container-fluid">
          <!-- Card Portion for Dashboards -->
          <div class="fade-in">
            <div class="row">


                <div class="col-lg-6 col-md-4 col-sm-12 col-xs-12 mx-0 my-2 px-1">
                  <div class="card h-100">
                    <div class="card-header"><strong>Monthly Visit Count - <%- dateToday.format("MMMM YYYY") %></strong></div>
                    <div class="card-body">
                      <div class="container">
                        <canvas id="monthlyVisitCountDash" height="200"></canvas>

                        <script>
                              var ctx = document.getElementById("monthlyVisitCountDash").getContext("2d");
                              var gradientStroke = ctx.createLinearGradient(500, 0, 100, 0);
                              gradientStroke.addColorStop(0, "#321FDB");
                              gradientStroke.addColorStop(1, "#b1aee8");

                              var monthlyVisitCountDash = new Chart(ctx, {
                                  type: 'horizontalBar',
                                  data: {
                                      labels: [
                                        <% for(var i = 0; i < result.activeAgents.length; i++) {%>
                                        "<%- result.activeAgents[i][0] %>",
                                                  <% } %>
                                          ],
                                      datasets: [{
                                          label: 'Visits',
                                          data: [
                                            <% for(var i = 0; i < result.activeAgents.length; i++) {%>
                                            "<%- result.activeAgents[i][1] %>",
                                                      <% } %>
                                          ],
                                          backgroundColor: gradientStroke
                                      }]
                                  },
                                  options: {
                                      legend: {
                                        display: false,
                                      },
                                      scales: {
                                        xAxes: [{
                                          ticks: {
                                            beginAtZero: true,
                                            stepSize: 1,
                                          }
                                        }]
                                      }
                                    }
                              });
                        </script>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-lg-6 col-md-4 col-sm-12 col-xs-12 mx-0 my-2 px-1">
                  <div class="card h-100">
                    <div class="card-header"><strong>Most Visited Customers (Past 30 Days)</strong></div>
                    <div class="card-body">
                      <div class="container">
                        <canvas id="mostVisitedDash" height="200"></canvas>
                        <script>
                              var ctx = document.getElementById("mostVisitedDash");
                              var mostVisitedDash = new Chart(ctx, {
                                  type: 'horizontalBar',
                                  data: {
                                      labels: [
                                        <% for(var i = 0; i < result.frequentClients.length; i++) {%>
                                        "<%- result.frequentClients[i][0]%>",
                                                  <% } %>

                                      ],
                                      datasets: [{
                                          label: 'Visits',
                                          data: [
                                            <% for(var i = 0; i < result.frequentClients.length; i++) {%>
                                            "<%- result.frequentClients[i][1] %>",
                                                      <% } %>
                                          ],
                                          backgroundColor: gradientStroke
                                      }]
                                  },
                                  options: {
                                      legend: {
                                        display: false,
                                      },
                                      scales: {
                                        xAxes: [{
                                          ticks: {
                                            stepSize: 1,
                                            beginAtZero: true,
                                          }
                                        }],
                                        yAxes:[{
                                          ticks: {
                                            mirror: true,
                                            z:1,
                                            padding: -10,
                                            fontStyle: 'normal',

                                          }
                                        }]
                                      }
                                    }

                              });
                        </script>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-lg-12 col-md-4 col-sm-12 col-xs-12 mx-0 my-2 px-1">
                  <div class="card h-100">
                    <div class="card-header"><strong>Clients Due for Visit</strong></div>
                    <div class="card-body">
                      <div class="table">
                          <table
                          data-toggle="table"
                          data-pagination="true"
                          data-pagination-successively-size="1"
                          data-pagination-pages-by-side="1"
                          data-pagination-parts="['pageInfoShort', 'pageSize', 'pageList']"
                          class="table table-hover table-bordered table-striped px-2 py-2">
                            <thead class="thead-light">
                              <tr>
                                <th data-halign="center" data-align="left" data-width="70" data-width-unit="%">Client</th>
                                <th data-halign="center" data-align="left" data-width="15" data-width-unit="%">Last Visit</th>
                                <th data-halign="center" data-align="left" data-width="15" data-width-unit="%">Days since Last Visit</th>
                              </tr>
                            </thead>
                            <tbody>
                                <%
                                    var list = '';
                                    var k = 1;
                                    for (i = 0; i < result.visitDue.length; i++) {
                                      list += '<tr>';
                                      list += '<td class=>' + result.visitDue[i][0] + '</td>';
                                      list += '<td style="text-align: center; vertical-align: middle;">' + result.visitDue[i][1]._i.substring(0,10) + '</td>';
                                      list += '<td style="text-align: center; vertical-align: middle;">' + result.visitDue[i][2] + '</td>';
                                      list += '</tr>';
                                      k++;
                                  }
                                  %>
                                <%- list %>

                            </tbody>
                          </table>
                        </div>
                    </div>
                  </div>
                </div>

            </div>
          </div>
        </div>
    </div>
    <footer class="c-footer">
      <!-- Footer content here -->
      <% include partials/footer %>
    </footer>
  </div>

  <!-- Optional JavaScript -->
 <!-- Popper.js first, then CoreUI JS -->
 <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.15.0/umd/popper.min.js" integrity="sha384-L2pyEeut/H3mtgCBaUNw7KWzp5n9&#43;4pDQiExs933/5QfaTh8YStYFFkOzSoXjlTb" crossorigin="anonymous"></script>
 <script src="https://unpkg.com/@coreui/coreui@3.0.0-rc.0/dist/js/coreui.min.js"></script>

 <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
 <script src="https://unpkg.com/bootstrap-table@1.18.0/dist/bootstrap-table.min.js"></script>
 </body>
</html>
